{"version":3,"file":"static/js/3639.00c07dc9.chunk.js","mappings":"8YAqG2B,O,0EAtFzB,qHACwBA,KAAKC,qBAD7B,aACwB,OAAAD,KAAqBA,KAAKE,QAAQ,oBAD1D,UACQC,EADR,6BAGU,IAAIC,MAAM,4BAHpB,gCAKSD,EAAQE,aALjB,kG,IAAA,kEAQA,yGACwBL,KAAKM,YAD7B,cACQH,EADR,yBAESA,EAAQI,eAFjB,kGARA,IAQA,yBAKA,SAAmBC,EAAeC,GAAoB,IAAD,OACnD,OAAOC,EAAAA,EAAAA,kBAAgB,yCAAU,WAAMC,GAAN,sIACD,EAAKL,YADJ,UACzBM,EADyB,OAEpB,IACEC,EAA8BL,EAArCM,MAAwBC,EAAaP,EAAlBQ,IACzBH,EAAaI,KAAKC,IAAI,EAAGL,EAFd,QAGXE,GAHW,KAKI,GAAKF,EAAaE,GAPF,wBAQ7BJ,EAASQ,WARoB,kCAYzBC,EAAMR,EAAgBS,aAAhB,kBAELb,GAFK,IAGRM,MAAOD,EACPG,IAAKD,IAEPN,GAlB6B,UAoBXW,EAAIE,MAAKC,EAAAA,EAAAA,MAAWC,YApBT,QA4B/B,GARMC,EApByB,OAqBzBC,GAAmB,UAAAD,EAAM,UAAN,eAAUE,IAAI,SAAU,GAC3CC,EAAS,EAAK1B,QAAQ,UACtB2B,EAAe,EAAK3B,QAAQ,iBAC5B4B,EAAgB,EAAK5B,QAAQ,iBAC7B6B,EAAkB,EAAK7B,QAAQ,mBAC/B8B,EAAK,IAAIC,OAAOL,EAAQ,KAAOG,EAAkB,IAAM,KAEzDH,EAAQ,CACV,GAAIC,EAAc,CACVK,EAAUR,EAASS,SAASH,GADlB,UAEIE,GAFJ,IAEhB,2BAAWE,EAAkB,QACrBC,EAAIxB,GAAcuB,EAAME,OAAS,IAEnCC,EAAAA,EAAAA,gBAAeF,EAAGA,EAAIT,EAAOY,OAAQhC,EAAMM,MAAON,EAAMQ,MAC1DL,EAAS8B,KACP,IAAIC,EAAAA,cAAc,CAChBC,SAAS,GAAD,OAAK,EAAKC,GAAV,kBAAsBP,EAAtB,MACRQ,QAASrC,EAAMqC,QACf/B,MAAOuB,EACPrB,IAAKqB,EAAID,EAAM,GAAGI,OAClBM,KAAMV,EAAM,GACZW,OAAQ,IAbA,+BAkBjB,CACD,GAAIjB,EAAe,CACXI,GAAUc,EAAAA,EAAAA,QAAOtB,GAAUS,SAASH,GADzB,UAEGE,GAFH,IAEjB,2BAAWE,EAAkB,QACrBC,EAAItB,GAAYqB,EAAME,OAAS,IACjCC,EAAAA,EAAAA,gBAAeF,EAAGA,EAAIT,EAAOY,OAAQhC,EAAMM,MAAON,EAAMQ,MAC1DL,EAAS8B,KACP,IAAIC,EAAAA,cAAc,CAChBC,SAAS,GAAD,OAAK,EAAKC,GAAV,kBAAsBP,EAAtB,MACRQ,QAASrC,EAAMqC,QACf/B,MAAOuB,EAAID,EAAM,GAAGI,OACpBM,KAAMV,EAAM,GACZpB,IAAKqB,EACLU,QAAS,IAZA,+BAiBlB,CACF,CAEDpC,EAASQ,WApEsB,4CAAV,sDAsExB,8BAED,WAAyB,O,CAvFE8B,EAAAA,uB","sources":["../../../plugins/sequence/src/SequenceSearchAdapter/SequenceSearchAdapter.ts"],"sourcesContent":["import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport {\n  SimpleFeature,\n  Feature,\n  Region,\n  revcom,\n  doesIntersect2,\n} from '@jbrowse/core/util'\nimport { toArray } from 'rxjs/operators'\n\nexport default class extends BaseFeatureDataAdapter {\n  public async configure() {\n    const adapter = await this.getSubAdapter?.(this.getConf('sequenceAdapter'))\n    if (!adapter) {\n      throw new Error('Error getting subadapter')\n    }\n    return adapter.dataAdapter as BaseFeatureDataAdapter\n  }\n\n  public async getRefNames() {\n    const adapter = await this.configure()\n    return adapter.getRefNames()\n  }\n\n  public getFeatures(query: Region, opts: BaseOptions) {\n    return ObservableCreate<Feature>(async observer => {\n      const sequenceAdapter = await this.configure()\n      const hw = 1000\n      let { start: queryStart, end: queryEnd } = query\n      queryStart = Math.max(0, queryStart - hw)\n      queryEnd += hw\n\n      if (queryEnd < 0 || queryStart > queryEnd) {\n        observer.complete()\n        return\n      }\n\n      const ret = sequenceAdapter.getFeatures(\n        {\n          ...query,\n          start: queryStart,\n          end: queryEnd,\n        },\n        opts,\n      )\n      const feats = await ret.pipe(toArray()).toPromise()\n      const residues: string = feats[0]?.get('seq') || ''\n      const search = this.getConf('search')\n      const searchFoward = this.getConf('searchForward')\n      const searchReverse = this.getConf('searchReverse')\n      const caseInsensitive = this.getConf('caseInsensitive')\n      const re = new RegExp(search, 'g' + (caseInsensitive ? 'i' : ''))\n\n      if (search) {\n        if (searchFoward) {\n          const matches = residues.matchAll(re)\n          for (const match of matches) {\n            const s = queryStart + (match.index || 0)\n\n            if (doesIntersect2(s, s + search.length, query.start, query.end)) {\n              observer.next(\n                new SimpleFeature({\n                  uniqueId: `${this.id}-match-${s}-p`,\n                  refName: query.refName,\n                  start: s,\n                  end: s + match[0].length,\n                  name: match[0],\n                  strand: 1,\n                }),\n              )\n            }\n          }\n        }\n        if (searchReverse) {\n          const matches = revcom(residues).matchAll(re)\n          for (const match of matches) {\n            const s = queryEnd - (match.index || 0)\n            if (doesIntersect2(s, s + search.length, query.start, query.end)) {\n              observer.next(\n                new SimpleFeature({\n                  uniqueId: `${this.id}-match-${s}-n`,\n                  refName: query.refName,\n                  start: s - match[0].length,\n                  name: match[0],\n                  end: s,\n                  strand: -1,\n                }),\n              )\n            }\n          }\n        }\n      }\n\n      observer.complete()\n    })\n  }\n\n  public freeResources() {}\n}\n"],"names":["this","getSubAdapter","getConf","adapter","Error","dataAdapter","configure","getRefNames","query","opts","ObservableCreate","observer","sequenceAdapter","queryStart","start","queryEnd","end","Math","max","complete","ret","getFeatures","pipe","toArray","toPromise","feats","residues","get","search","searchFoward","searchReverse","caseInsensitive","re","RegExp","matches","matchAll","match","s","index","doesIntersect2","length","next","SimpleFeature","uniqueId","id","refName","name","strand","revcom","BaseFeatureDataAdapter"],"sourceRoot":""}