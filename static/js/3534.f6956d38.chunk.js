"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[3534],{83534:function(e,n,t){t.r(n),t.d(n,{Attributes:function(){return ce},BaseAttributes:function(){return ue},BaseCard:function(){return Q},BaseCoreDetails:function(){return ae},BasicValue:function(){return $},FeatureDetails:function(){return de},FieldName:function(){return X},SimpleValue:function(){return ee},UriLink:function(){return ie},default:function(){return fe},useStyles:function(){return K}});var r=t(59740),a=t(33028),i=t(68079),s=t(96234),o=t(30969),c=t(51921),u=t(1108),l=t(94927),d=t(70054),f=t(28744),p=t(21777),x=t(74466),m=t(2374),v=t(23038),h=t(7456),j=t(90550),g=t(38184),Z=t.n(g),b=t(9077),y=t(81073),w=t(36174),k=t(32723),S=t(34795),N=t(3562),_=t(89003),C=t(28712),q=t(69852),F=t(45437),D=t(34760),O=t.n(D);function I(e,n){return e.map((function(e){return n.slice(e.start,e.end)})).join("")}function T(e){return"".concat(e.start,"-").concat(e.end)}function E(e){return e.filter((function(e,n,t){return!n||T(e)!==T(t[n-1])}))}function L(e,n){return e.map((function(e){return(0,a.Z)((0,a.Z)({},e),{},{start:n-e.end,end:n-e.start})})).sort((function(e,n){return e.start-n.start}))}var M=t(37574),A=(0,m.ZL)()((function(e){return{button:{margin:e.spacing(1)}}})),U="rgb(220,220,180)",B="rgba(250,200,200)";function R(e){var n=e.cds,t=e.sequence;return(0,M.jsx)("span",{style:{background:U},children:I(n,t)})}function P(e){for(var n=e.cds,t=e.sequence,r=e.codonTable,a=I(n,t),i="",s=0;s<a.length;s+=3)i+=r[a.slice(s,s+3)]||"&";return(0,M.jsx)("span",{style:{background:"rgb(220,160,220)"},children:i})}function J(e){var n=e.utr,t=e.cds,r=e.exons,a=e.sequence,s=e.upstream,c=e.downstream,u=e.includeIntrons,l=e.collapseIntron,d=t.length?[].concat((0,i.Z)(t),(0,i.Z)(n)).sort((function(e,n){return e.start-n.start})):r;return(0,M.jsxs)(M.Fragment,{children:[s?(0,M.jsx)("span",{style:{background:B},children:s}):null,d.filter((function(e){return e.start!==e.end})).map((function(e,n){var t,r=a.slice(e.end,null===(t=d[n+1])||void 0===t?void 0:t.start);return(0,M.jsxs)(o.Fragment,{children:[(0,M.jsx)("span",{style:{background:"CDS"===e.type?U:"rgb(200,240,240)"},children:a.slice(e.start,e.end)}),u&&n<d.length-1?(0,M.jsx)("span",{style:{background:undefined},children:l&&r.length>20?"".concat(r.slice(0,10),"...").concat(r.slice(-10)):r}):null]},JSON.stringify(e))})),c?(0,M.jsx)("span",{style:{background:B},children:c}):null]})}var G=o.forwardRef((function(e,n){var t=e.feature,r=e.mode,s=e.sequence,o=s.seq,c=s.upstream,u=void 0===c?"":c,l=s.downstream,d=void 0===l?"":l,f=t.subfeatures,p=(0,y.generateCodonTable)(y.defaultCodonTable);if(!f)return null;var x=f.sort((function(e,n){return e.start-n.start})).map((function(e){return(0,a.Z)((0,a.Z)({},e),{},{start:e.start-t.start,end:e.end-t.start})})),m=E(x.filter((function(e){return"CDS"===e.type}))),v=E(x.filter((function(e){return e.type.match(/utr/i)}))),h=E(x.filter((function(e){return"exon"===e.type})));if(!v.length&&m.length&&h.length&&(v=function(e,n){var t=e[0],r=e[e.length-1],s=n.findIndex((function(e){return e.end>=t.start&&e.start<=t.start})),o=n.findIndex((function(e){return e.end>=r.end&&e.start<=r.end})),c=n[o],u=n[s],l=[].concat((0,i.Z)(n.slice(0,s)),[{start:u.start,end:t.start}]).map((function(e){return(0,a.Z)((0,a.Z)({},e),{},{type:"five_prime_UTR"})})),d=[{start:r.end,end:c.end}].concat((0,i.Z)(n.slice(o+1))).map((function(e){return(0,a.Z)((0,a.Z)({},e),{},{type:"three_prime_UTR"})}));return[].concat((0,i.Z)(l),(0,i.Z)(d))}(m,h)),-1===t.strand){var j=[(0,y.revcom)(o),(0,y.revcom)(d),(0,y.revcom)(u)];u=j[1],d=j[2],m=L(m,(o=j[0]).length),h=L(h,o.length),v=L(v,o.length)}return(0,M.jsx)("div",{ref:n,"data-testid":"sequence_panel",children:(0,M.jsxs)("div",{style:{fontFamily:"monospace",wordWrap:"break-word",fontSize:12,maxWidth:600},children:[">".concat(t.name||t.id||"unknown","-").concat(r,"\n"),"cds"===r?(0,M.jsx)(R,{cds:m,sequence:o}):"cdna"===r?(0,M.jsx)(J,{exons:h,cds:m,utr:v,sequence:o}):"protein"===r?(0,M.jsx)(P,{cds:m,codonTable:p,sequence:o}):"gene"===r?(0,M.jsx)(J,{exons:h,cds:m,utr:v,sequence:o,includeIntrons:!0}):"gene_collapsed_intron"===r?(0,M.jsx)(J,{exons:h,cds:m,sequence:o,utr:v,includeIntrons:!0,collapseIntron:!0}):"gene_updownstream"===r?(0,M.jsx)(J,{exons:h,cds:m,sequence:o,utr:v,upstream:u,downstream:d,includeIntrons:!0}):"gene_updownstream_collapsed_intron"===r?(0,M.jsx)(J,{exons:h,cds:m,sequence:o,utr:v,upstream:u,downstream:d,includeIntrons:!0,collapseIntron:!0}):(0,M.jsx)("div",{children:"Unknown type"})]})})}));function H(e){var n,t=e.model,r=e.feature,a=A().classes,i=r,c=null===(n=i.subfeatures)||void 0===n?void 0:n.find((function(e){return"CDS"===e.type})),u=(0,o.useRef)(null),l=(0,F.YD)(),f=l.ref,x=l.inView,m=(0,o.useState)(),v=(0,s.Z)(m,2),h=v[0],j=v[1],g=(0,o.useState)(),Z=(0,s.Z)(g,2),w=Z[0],D=Z[1],I=(0,o.useState)(c?"cds":"cdna"),T=(0,s.Z)(I,2),E=T[0],L=T[1],U=(0,o.useState)(!1),B=(0,s.Z)(U,2),R=B[0],P=B[1],J=(0,o.useState)(!1),H=(0,s.Z)(J,2),V=H[0],z=H[1];(0,o.useEffect)((function(){var e,n=!1;if(!t||!x)return function(){};var a=(0,y.getSession)(t),i=a.assemblyManager,o=a.rpcManager,c=(null===(e=t.view)||void 0===e?void 0:e.assemblyNames)||[],u=(0,s.Z)(c,1)[0];function l(e,n,t){return d.apply(this,arguments)}function d(){return(d=(0,S.Z)((0,k.Z)().mark((function e(n,t,r){var a,c,l,d,f,p;return(0,k.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.waitForAssembly(u);case 2:if(a=e.sent){e.next=5;break}throw new Error("assembly not found");case 5:return c="getSequence",e.next=8,o.call(c,"CoreGetFeatures",{adapterConfig:(0,b.getConf)(a,["sequence","adapter"]),sessionId:c,regions:[{start:n,end:t,refName:a.getCanonicalRefName(r)}]});case 8:if(l=e.sent,d=l,f=(0,s.Z)(d,1),p=f[0]){e.next=12;break}throw new Error("sequence not found for feature with refName:".concat(r));case 12:return e.abrupt("return",p.get("seq"));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return(0,S.Z)((0,k.Z)().mark((function e(){var t,a,i,s,o,c,u;return(0,k.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=(t=r).start,i=t.end,s=t.refName,e.next=4,l(a,i,s);case 4:return o=e.sent,e.next=7,l(Math.max(0,a-500),a,s);case 7:return c=e.sent,e.next=10,l(i,i+500,s);case 10:u=e.sent,n||j({seq:o,upstream:c,downstream:u}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),D(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})))(),function(){n=!0}}),[r,x,t]);var W=!h;return(0,M.jsxs)("div",{ref:f,children:[(0,M.jsx)(N.Z,{children:(0,M.jsxs)(_.Z,{value:E,onChange:function(e){return L(e.target.value)},children:[c?(0,M.jsx)(C.Z,{value:"cds",children:"CDS"}):null,c?(0,M.jsx)(C.Z,{value:"protein",children:"Protein"}):null,(0,M.jsx)(C.Z,{value:"gene",children:"Gene w/ introns"}),(0,M.jsx)(C.Z,{value:"gene_collapsed_intron",children:"Gene w/ 10bp of intron"}),(0,M.jsx)(C.Z,{value:"gene_updownstream",children:"Gene w/ 500bp up+down stream"}),(0,M.jsx)(C.Z,{value:"gene_updownstream_collapsed_intron",children:"Gene w/ 500bp up+down stream w/ 10bp intron"}),(0,M.jsx)(C.Z,{value:"cdna",children:"cDNA"})]})}),(0,M.jsx)(q.Z,{className:a.button,type:"button",variant:"contained",onClick:function(){var e=u.current;e&&(O()(e.textContent||"",{format:"text/plain"}),P(!0),setTimeout((function(){return P(!1)}),1e3))},children:R?"Copied to clipboard!":"Copy as plaintext"}),(0,M.jsx)(p.Z,{title:"Note that 'Copy as HTML' can retain the colors but cannot be pasted into some programs like notepad that only expect plain text",children:(0,M.jsx)(q.Z,{className:a.button,type:"button",variant:"contained",onClick:function(){var e=u.current;e&&(O()(e.innerHTML,{format:"text/html"}),z(!0),setTimeout((function(){return z(!1)}),1e3))},children:V?"Copied to clipboard!":"Copy as HTML"})}),(0,M.jsx)("div",{"data-testid":"feature_sequence",children:w?(0,M.jsx)(d.Z,{color:"error",children:"".concat(w)}):W?(0,M.jsx)("div",{children:"Loading gene sequence..."}):h?(0,M.jsx)(G,{ref:u,feature:i,mode:E,sequence:h}):(0,M.jsx)("div",{children:"No sequence found"})})]})}var V=["id"],z=["__jbrowsefmt"],W=["__jbrowsefmt","length","position","subfeatures","uniqueId","exonFrames","parentId","thickStart","thickEnd"],Y=["name","start","end","strand","refName","description","type"],K=(0,m.ZL)()((function(e){return{expansionPanelDetails:{display:"block",padding:e.spacing(1)},expandIcon:{color:"#FFFFFF"},field:{display:"flex",flexWrap:"wrap"},fieldDescription:{"&:hover":{background:"yellow"}},fieldName:{wordBreak:"break-all",minWidth:90,borderBottom:"1px solid #0003",fontSize:12,background:e.palette.grey[200],marginRight:e.spacing(1),padding:e.spacing(.5)},fieldValue:{wordBreak:"break-word",maxHeight:300,fontSize:12,padding:e.spacing(.5),overflow:"auto"},fieldSubvalue:{wordBreak:"break-word",maxHeight:300,padding:e.spacing(.5),background:e.palette.grey[100],border:"1px solid ".concat(e.palette.grey[300]),boxSizing:"border-box",overflow:"auto"}}}));function Q(e){var n=e.children,t=e.title,r=e.defaultExpanded,a=void 0===r||r,i=K().classes,c=(0,o.useState)(a),p=(0,s.Z)(c,2),x=p[0],m=p[1];return(0,M.jsxs)(u.Z,{expanded:x,onChange:function(){return m((function(e){return!e}))},TransitionProps:{unmountOnExit:!0},children:[(0,M.jsx)(l.Z,{expandIcon:(0,M.jsx)(v.Z,{className:i.expandIcon}),children:(0,M.jsxs)(d.Z,{variant:"button",children:[" ",t]})}),(0,M.jsx)(f.Z,{className:i.expansionPanelDetails,children:n})]})}var X=function(e){var n=e.description,t=e.name,r=e.width,a=e.prefix,s=void 0===a?[]:a,o=K(),c=o.classes,u=o.cx,l=[].concat((0,i.Z)(s),[t]).join(".");return n?(0,M.jsx)(p.Z,{title:n,placement:"left",children:(0,M.jsx)("div",{className:u(c.fieldDescription,c.fieldName),children:l})}):(0,M.jsx)("div",{className:c.fieldName,style:{width:r},children:l})},$=function(e){var n=e.value,t=K().classes,r="".concat(n).match(/^https?:\/\//);return(0,M.jsx)("div",{className:t.fieldValue,children:o.isValidElement(n)?n:r?(0,M.jsx)(w.Z,{html:'<a href="'.concat(n,'">').concat(n,"</a>")}):(0,M.jsx)(w.Z,{html:Z()(n)?JSON.stringify(n):String(n)})})},ee=function(e){var n=e.name,t=e.value,r=e.description,a=e.prefix,i=e.width,s=K().classes;return null!==t&&void 0!==t?(0,M.jsxs)("div",{className:s.field,children:[(0,M.jsx)(X,{prefix:a,description:r,name:n,width:i}),(0,M.jsx)($,{value:t})]}):null},ne=function(e){var n=e.name,t=e.value,r=e.description,a=e.prefix,s=void 0===a?[]:a,o=K().classes;return 1===t.length?Z()(t[0])?(0,M.jsx)(ce,{attributes:t[0],prefix:[].concat((0,i.Z)(s),[n])}):(0,M.jsxs)("div",{className:o.field,children:[(0,M.jsx)(X,{prefix:s,description:r,name:n}),(0,M.jsx)($,{value:t[0]})]}):t.every((function(e){return Z()(e)}))?(0,M.jsx)(M.Fragment,{children:t.map((function(e,t){return(0,M.jsx)(ce,{attributes:e,prefix:[].concat((0,i.Z)(s),[n+"-"+t])},JSON.stringify(e)+"-"+t)}))}):(0,M.jsxs)("div",{className:o.field,children:[(0,M.jsx)(X,{prefix:s,description:r,name:n}),t.map((function(e,n){return(0,M.jsx)("div",{className:o.fieldSubvalue,children:(0,M.jsx)($,{value:e})},JSON.stringify(e)+"-"+n)}))]})},te=function(e){return e.toLocaleString("en-US")};function re(e){var n=e.feature,t=(0,a.Z)((0,a.Z)({},n),n.__jbrowsefmt),r=t.start,i=t.strand,o=t.end,c=t.refName,u={"-1":"-",0:"",1:"+"},l=u[i]?"(".concat(u[i],")"):"",d=(0,a.Z)((0,a.Z)({},t),{},{length:te(o-r),position:"".concat(c,":").concat(te(r+1),"..").concat(te(o)," ").concat(l)});return(0,M.jsx)(M.Fragment,{children:Object.entries({position:"Position",description:"Description",name:"Name",length:"Length",type:"Type",assemblyName:"Assembly name"}).map((function(e){var n=(0,s.Z)(e,2),t=n[0];return[n[1],d[t]]})).filter((function(e){var n=(0,s.Z)(e,2)[1];return null!==n&&void 0!==n})).map((function(e){var n=(0,s.Z)(e,2),t=n[0],r=n[1];return(0,M.jsx)(ee,{name:t,value:r},t)}))})}var ae=function(e){return(0,M.jsx)(Q,(0,a.Z)((0,a.Z)({},e),{},{title:"Primary data",children:(0,M.jsx)(re,(0,a.Z)({},e))}))};function ie(e){var n=e.value,t=(0,y.getUriLink)(n);return(0,M.jsx)(w.Z,{html:'<a href="'.concat(t,'">').concat(t,"</a>")})}var se=function(e){var n=e.value,t=e.prefix,o=e.name,c=Object.keys(n[0]).sort(),u=new Set(c);if(n.forEach((function(e){return Object.keys(e).forEach((function(e){return u.add(e)}))})),u.size<c.length+5){var l,d=Object.entries(n).map((function(e){var n=(0,s.Z)(e,2),t=n[0],i=n[1],o=i.id,c=(0,r.Z)(i,V);return(0,a.Z)({id:t,identifier:o},c)}));u.has("id")?(u.delete("id"),l=["identifier"].concat((0,i.Z)(u))):l=(0,i.Z)(u);var f=l.map((function(e){return{field:e,renderCell:function(e){var n=e.value;return(0,y.isUriLocation)(n)?(0,M.jsx)(ie,{value:n}):(0,y.getStr)(n)},width:(0,y.measureGridWidth)(d.map((function(n){return n[e]})))}})),p=d.length<100;return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(X,{prefix:t,name:o}),(0,M.jsx)("div",{style:{height:25*Math.min(d.length,100)+80+(p?0:50),width:"100%"},children:(0,M.jsx)(h._,{disableSelectionOnClick:!0,rowHeight:25,rows:d,rowsPerPageOptions:[],hideFooterSelectedRowCount:!0,columns:f,hideFooter:p})})]})}return null};function oe(e){var n,t=e.value,r=e.prefix,a=e.name,i=K().classes,s=t.uri,o=t.baseUri,c=void 0===o?"":o;try{n=new URL(s,c).href}catch(u){n=s}return(0,M.jsxs)("div",{className:i.field,children:[(0,M.jsx)(X,{prefix:r,name:a}),(0,M.jsx)($,{value:n})]})}function ce(e){var n=e.attributes,t=e.omit,c=void 0===t?[]:t,u=e.descriptions,l=e.formatter,d=void 0===l?function(e){return e}:l,f=e.prefix,p=void 0===f?[]:f,x=[].concat((0,i.Z)(c),W),m=n.__jbrowsefmt,v=(0,r.Z)(n,z),h=(0,a.Z)((0,a.Z)({},v),m),j=function(e,n){var t=[];return e.forEach((function(e,r){var a=[].concat((0,i.Z)(n),[e[0]]).join(".");t.push((0,y.measureText)(a,12))})),Math.ceil(Math.max.apply(Math,t))+10}(Object.entries(h).filter((function(e){var n=(0,s.Z)(e,2),t=n[0];return void 0!==n[1]&&!x.includes(t)})),p);return(0,M.jsx)(M.Fragment,{children:Object.entries(h).filter((function(e){var n=(0,s.Z)(e,2),t=n[0];return void 0!==n[1]&&!x.includes(t)})).map((function(n){var t=(0,s.Z)(n,2),r=t[0],c=t[1],l=function(e){var n,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.forEach((function(e){t&&(t=t[e])})),"string"===typeof t?t:"string"===typeof(null===(n=t)||void 0===n?void 0:n.Description)?t.Description:void 0}([].concat((0,i.Z)(p),[r]),u);return Array.isArray(c)?c.length>1&&c.every((function(e){return Z()(e)}))?(0,M.jsx)(se,{name:r,prefix:p,value:c},r):(0,M.jsx)(ne,{name:r,value:c,description:l,prefix:p},r):Z()(c)?(0,y.isUriLocation)(c)?(0,M.jsx)(oe,{name:r,prefix:p,value:c},r):(0,o.createElement)(ce,(0,a.Z)((0,a.Z)({},e),{},{omit:x,key:r,attributes:c,descriptions:u,prefix:[].concat((0,i.Z)(p),[r])})):(0,M.jsx)(ee,{name:r,value:d(c,r),description:l,prefix:p,width:Math.min(j,170)},r)}))})}var ue=function(e){var n=e.feature;return(0,M.jsx)(Q,(0,a.Z)((0,a.Z)({},e),{},{title:"Attributes",children:(0,M.jsx)(ce,(0,a.Z)((0,a.Z)({},e),{},{attributes:n}))}))};function le(e,n,t){return[(r="".concat(e)||"".concat(n),r.length>20?"".concat(r.slice(0,20),"..."):r),"".concat(t)].filter((function(e){return!!e})).join(" - ");var r}var de=function e(n){var t=n.omit,r=void 0===t?[]:t,s=n.model,o=n.feature,u=n.depth,l=void 0===u?0:u,f=o.name,p=void 0===f?"":f,m=o.id,v=void 0===m?"":m,h=o.type,j=void 0===h?"":h,g=o.subfeatures,Z=(0,y.getSession)(s),w=(0,b.getConf)(Z,["featureDetails","sequenceTypes"])||["mRNA","transcript"];return(0,M.jsxs)(Q,{title:le(p,v,j),children:[(0,M.jsx)(d.Z,{children:"Core details"}),(0,M.jsx)(re,(0,a.Z)({},n)),(0,M.jsx)(x.Z,{}),(0,M.jsx)(d.Z,{children:"Attributes"}),(0,M.jsx)(ce,(0,a.Z)((0,a.Z)({attributes:o},n),{},{omit:[].concat((0,i.Z)(r),Y)})),w.includes(o.type)?(0,M.jsx)(c.ErrorBoundary,{FallbackComponent:function(e){var n=e.error;return(0,M.jsx)(d.Z,{color:"error",children:"".concat(n)})},children:(0,M.jsx)(H,(0,a.Z)({},n))}):null,null!==g&&void 0!==g&&g.length?(0,M.jsx)(Q,{title:"Subfeatures",defaultExpanded:!w.includes(o.type),children:g.map((function(n){return(0,M.jsx)(e,{feature:n,model:s,depth:l+1},JSON.stringify(n))}))}):null]})},fe=(0,j.observer)((function(e){var n=e.model,t=n.featureData;if(!t)return null;var r,a=JSON.parse(JSON.stringify(t,(function(e,n){return"undefined"===typeof n?null:n})));return r=a,0===Object.keys(r).length?null:(0,M.jsx)(de,{model:n,feature:a})}))}}]);
//# sourceMappingURL=3534.f6956d38.chunk.js.map